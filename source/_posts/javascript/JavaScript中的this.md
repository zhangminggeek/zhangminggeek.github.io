---
title: JavaScriptä¸­çš„this
date: 2018-11-12 10:10:22
categories: JavaScript
tags: [JavaScript, this, å‰ç«¯]
---

&emsp;&emsp;**thisæ˜¯åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºæ—¶ç¡®å®šçš„ä¸€ä¸ªåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å¯æ›´æ”¹çš„å˜é‡ã€‚**æ‰€è°“æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå°±æ˜¯JavaScriptå¼•æ“Žåœ¨æ‰§è¡Œä¸€æ®µä»£ç ä¹‹å‰å°†ä»£ç å†…éƒ¨ä¼šç”¨åˆ°çš„ä¸€äº›å˜é‡ã€å‡½æ•°ã€thisæå‰å£°æ˜Žç„¶åŽä¿å­˜åœ¨å˜é‡å¯¹è±¡ä¸­çš„è¿‡ç¨‹ã€‚è¿™ä¸ª'ä»£ç ç‰‡æ®µ'åŒ…æ‹¬ï¼šå…¨å±€ä»£ç (scriptæ ‡ç­¾å†…éƒ¨çš„ä»£ç )ã€å‡½æ•°å†…éƒ¨ä»£ç ã€evalå†…éƒ¨ä»£ç ã€‚è€Œæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ä½œç”¨åŸŸé“¾ä¹Ÿä¼šåœ¨ä¿å­˜åœ¨è¿™é‡Œï¼Œä»¥ä¸€ä¸ªç±»æ•°ç»„çš„å½¢å¼å­˜å‚¨åœ¨å¯¹åº”å‡½æ•°çš„[[Scopes]]å±žæ€§ä¸­ã€‚
&emsp;&emsp;thisåªåœ¨å‡½æ•°è°ƒç”¨é˜¶æ®µç¡®å®šï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºçš„é˜¶æ®µè¿›è¡Œèµ‹å€¼ï¼Œä¿å­˜åœ¨å˜é‡å¯¹è±¡ä¸­ã€‚è¿™ä¸ªç‰¹æ€§ä¹Ÿå¯¼è‡´äº†thisçš„å¤šå˜æ€§:ðŸ™‚å³å½“å‡½æ•°åœ¨ä¸åŒçš„è°ƒç”¨æ–¹å¼ä¸‹éƒ½å¯èƒ½ä¼šå¯¼è‡´thisçš„å€¼ä¸åŒã€‚
```javascript
var a = 1;
function fun() { 
    'use strict';
    var a = 2;
    return this.a;
}
```
ðŸ‘†ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒthisæŒ‡å‘undefined;
ðŸ‘†éžä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒthisæŒ‡å‘window;

&emsp;&emsp;å½“å‡½æ•°ç‹¬ç«‹è°ƒç”¨çš„æ—¶å€™ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å®ƒçš„thisæŒ‡å‘undefinedï¼Œåœ¨éžä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå½“thisæŒ‡å‘undefinedçš„æ—¶å€™ï¼Œè‡ªåŠ¨æŒ‡å‘å…¨å±€å¯¹è±¡(æµè§ˆå™¨ä¸­æ˜¯windowï¼Œnode ä¸­æ˜¯ global)ã€‚

## ç›´æŽ¥è°ƒç”¨
å½“å‡½æ•°ç‹¬ç«‹è°ƒç”¨çš„æ—¶å€™ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å®ƒçš„thisæŒ‡å‘undefinedï¼Œåœ¨éžä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå½“thisæŒ‡å‘undefinedçš„æ—¶å€™ï¼Œè‡ªåŠ¨æŒ‡å‘å…¨å±€å¯¹è±¡(æµè§ˆå™¨ä¸­å°±æ˜¯window)ã€‚

## ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•
```javascript
var a = 1; 
var obj = { 
    a: 2, 
    b: function() { 
        return this.a; 
    } 
} 
console.log(obj.b())//2
```
ðŸ‘†bæ‰€å¼•ç”¨çš„åŒ¿åå‡½æ•°ä½œä¸ºobjçš„ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œè¿™æ—¶å€™thisæŒ‡å‘è°ƒç”¨å®ƒçš„å¯¹è±¡ã€‚è¿™é‡Œä¹Ÿå°±æ˜¯objã€‚

```javascript
var a = 1; 
var obj = { 
    a: 2,
    b: function() { 
        return this.a; 
    } 
} 
var t = obj.b; 
console.log(t());//1
```
å¦‚ä¸Šï¼Œtå‡½æ•°æ‰§è¡Œç»“æžœç«Ÿç„¶æ˜¯å…¨å±€å˜é‡1ï¼Œä¸ºå•¥å‘¢ï¼Ÿè¿™å°±æ¶‰åŠJavascriptçš„å†…å­˜ç©ºé—´äº†ï¼Œå°±æ˜¯è¯´ï¼Œobjå¯¹è±¡çš„bå±žæ€§å­˜å‚¨çš„æ˜¯å¯¹è¯¥åŒ¿åå‡½æ•°çš„ä¸€ä¸ªå¼•ç”¨ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŒ‡é’ˆã€‚å½“èµ‹å€¼ç»™tçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰å•ç‹¬å¼€è¾Ÿå†…å­˜ç©ºé—´å­˜å‚¨æ–°çš„å‡½æ•°ï¼Œè€Œæ˜¯è®©tå­˜å‚¨äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå‡½æ•°ã€‚ç›¸å½“äºŽæ‰§è¡Œäº†è¿™ä¹ˆä¸€æ®µä¼ªä»£ç  ðŸ‘‡ï¼š
```javascript
var a = 1; 
function fun() {//æ­¤å‡½æ•°å­˜å‚¨åœ¨å †ä¸­ 
    return this.a; 
} 
var obj = { 
    a: 2, 
    b: fun //bæŒ‡å‘funå‡½æ•° 
} 
var t = fun;//å˜é‡tæŒ‡å‘funå‡½æ•° 
console.log(t());//1
```

## ä½¿ç”¨applyï¼Œcall
ä¿®æ”¹thisæŒ‡å‘ä¸ºç»™å®šå€¼
apply å’Œ call åŸºæœ¬ç±»ä¼¼ï¼Œä»–ä»¬çš„åŒºåˆ«åªæ˜¯ä¼ å…¥çš„å‚æ•°ä¸åŒã€‚call æ–¹æ³•æŽ¥å—çš„æ˜¯è‹¥å¹²ä¸ªå‚æ•°åˆ—è¡¨ï¼Œè€Œ apply æŽ¥æ”¶çš„æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„ã€‚
applyçš„è¯­æ³•ï¼š
```javascript
fun.apply(thisArg, [argsArray])
```
callçš„è¯­æ³•ï¼š
```javascript
fun.call(thisArg[, arg1[, arg2[, ...]]])
```
call() å’Œ apply() æ˜¯é¢„å®šä¹‰çš„å‡½æ•°æ–¹æ³•ã€‚ ä¸¤ä¸ªæ–¹æ³•å¯ç”¨äºŽè°ƒç”¨å‡½æ•°ï¼Œä¸¤ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¯¹è±¡æœ¬èº«
åœ¨ JavaScript ä¸¥æ ¼æ¨¡å¼(strict mode)ä¸‹, åœ¨è°ƒç”¨å‡½æ•°æ—¶ç¬¬ä¸€ä¸ªå‚æ•°ä¼šæˆä¸º this çš„å€¼ï¼Œ å³ä½¿è¯¥å‚æ•°ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚
åœ¨ JavaScript éžä¸¥æ ¼æ¨¡å¼(non-strict mode)ä¸‹, å¦‚æžœç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼æ˜¯ null æˆ– undefined, å®ƒå°†ä½¿ç”¨å…¨å±€å¯¹è±¡æ›¿ä»£ã€‚

## ä½œä¸ºæž„é€ å‡½æ•°
ä½¿ç”¨newå…³é”®å­—è°ƒç”¨å‡½æ•°çš„è¿‡ç¨‹ï¼š
```javascript
var foo = new Func() {
    // åˆ›å»ºç©ºå¯¹è±¡
    var obj = {};
    // è®¾ç½®æ–°å¯¹è±¡çš„constructorå±žæ€§ä¸ºæž„é€ å‡½æ•°çš„åç§°ï¼Œè®¾ç½®æ–°å¯¹è±¡çš„__proto__å±žæ€§æŒ‡å‘æž„é€ å‡½æ•°prototypeå¯¹è±¡;
    obj.__proto__ = Func.prototype;
    // ä½¿ç”¨æ–°å¯¹è±¡è°ƒç”¨å‡½æ•°ï¼Œå‡½æ•°ä¸­çš„thisè¢«æŒ‡å‘æ–°å®žä¾‹å¯¹è±¡;
    var result = Func.apply(obj, arguments);
    // ç¡®ä¿ new å‡ºæ¥çš„æ˜¯ä¸ªå¯¹è±¡ è¿”å›žçš„å€¼æ˜¯ä»€ä¹ˆå°±returnä»€ä¹ˆ
    return typeof result === 'object' ? result : obj;
}
```

## ç®­å¤´å‡½æ•°
**ç®­å¤´å‡½æ•°ä¼šæ•èŽ·å…¶æ‰€åœ¨ä¸Šä¸‹æ–‡çš„ this å€¼ï¼Œä½œä¸ºè‡ªå·±çš„ this å€¼**ï¼Œä¹Ÿå°±æ˜¯è¯´ç®­å¤´å‡½æ•°çš„thisåœ¨è¯æ³•å±‚é¢å°±å®Œæˆäº†ç»‘å®šã€‚applyï¼Œcallæ–¹æ³•åªæ˜¯ä¼ å…¥å‚æ•°ï¼Œå´æ”¹ä¸äº†thisã€‚
```javascript
var a = 1; 
var obj = { 
    a: 2 
}; 
var fun = () => console.log(this.a); 
fun();//1 
fun.call(obj)//1
```